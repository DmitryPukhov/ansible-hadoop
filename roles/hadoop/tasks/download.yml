---
# Create hadoop user
- name: add hadoop group
  group: name={{ hadoop_group }}

- name: add hadoop user
  user: name={{ hadoop_user}} group={{ hadoop_group }} groups=sudo home={{ hadoop_user_home }} shell=/bin/bash

- name: Apt install {{ item }}
  action: apt pkg={{ item }} state=installed update_cache=yes cache_valid_time=604800
  with_items:
  - wget
  - tar
  - gzip
  - unzip

- name: install java
  apt: name={{ java_package }} state=present

- name: download hadoop
  get_url:
    url: '{{ hadoop_mirrors|random }}/hadoop-{{ hadoop_version }}.tar.gz'
    dest: '{{ hadoop_home }}-{{ hadoop_version }}.tar.gz'
    force: no
  register: result
  until: result|success
  retries: 5
  delay: 2
  sudo: yes


- name: extract hadoop tarball
  command: '/usr/bin/env tar xf hadoop-{{ hadoop_version }}.tar.gz'
  args:
    chdir: '{{ hadoop_home }}/..'
    creates: '{{ hadoop_home }}/hadoop-{{ hadoop_version }}'
  sudo: yes


- name: chown to hadoop user
  file:
    dest: '{{ hadoop_home }}-{{ hadoop_version }}'
    owner: '{{ hadoop_user }}'
    group: '{{ hadoop_group }}'
    recurse: yes

- name: create link to hadoop
  file:
    src: '{{ hadoop_home }}-{{ hadoop_version }}'
    dest: '{{ hadoop_home }}'
    state: link
    owner: '{{ hadoop_user }}'
    group: '{{ hadoop_group }}'

- name: Creates directory
  file:
    path: '{{ hadoop_home }}-{{ hadoop_version }}/logs'
    state: directory
    owner: '{{ hadoop_user }}'
    group: '{{ hadoop_group }}'
    mode: 0664



